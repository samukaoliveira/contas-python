{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Finanças</title>

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    
    <link rel="stylesheet" href="{% static 'contas/app.css' %}">

</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
    <!-- BOTÃO MENU -->
    <button class="menu-btn" onclick="toggleMenu()" aria-label="Menu">
        <i class="fa-solid fa-bars"></i>
    </button>

    <!-- MENU LATERAL -->
    {% include "contas/shared/_menu.html" %}

    <!-- COMPETÊNCIA -->
    {% include "contas/shared/_competencia.html" %}

    <!-- AÇÕES -->
    <div class="login">
        <button class="logout-btn">
            ⎋ Sair
        </button>
    </div>
</div>

<!-- AÇÕES -->
 <div class="acoes">
    <button class="add-lancamento-btn" onclick="openModal()">
        <i class="fa-solid fa-circle-plus"></i> Novo Cartão
    </button>
</div>

<!-- ===== RESUMO ===== -->
<div class="cards">

    <div class="card saldo">
        <h3><i class="fa-solid fa-sack-dollar"></i> Fatura Atual</h3>
        <p class="despesa">R$ </p>
    </div>

    <div class="card">
        <h3><i class="fa-solid fa-arrow-trend-up"></i> Compras parceladas</h3>
        <p class="receita">R$ </p>
    </div>
</div>

<!-- ===== TABELA ===== -->
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Limite</th>
                <th>Fechamento</th>
                <th>Vencimento</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
        {% for c in cartoes %}
            <tr>
                <td>{{ c.descricao }}</td>
                <td class="valor">R$ {{ c.limite }}</td>
                <td>{{ c.fechamento }}</td>
                <td>{{ c.vencimento }}</td>
                <td><button onclick="openEditModal(
                        '{{ c.id }}',
                        '{{ c.descricao }}',
                        '{{ c.limite }}',
                        '{{ c.fechamento }}',
                        '{{ c.vencimento }}')">
                        <i class="fa-solid fa-pen"></i>
                    </button>
                    <a href="{% url 'cartao_show_path' c.id %}">
                        <button>
                            <i class="fa-solid fa-eye"></i>
                        </button>
                    </a>
                </td>
                <td></td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- MODAL -->
<div id="modalLancamento" class="modal">
    <div class="modal-content">
        <header class="modal-header">
            <h2>
                {% if cartao %}
                    Editar Cartão
                {% else %}
                    Novo Cartão
                {% endif %}
            </h2>
            <button class="close-btn" onclick="closeModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </header>

        <form method="post" action="{% if cartao %}
                          {% url 'cartoes_edit_path' cartao.id %}
                      {% else %}
                          {% url 'cartoes_create_path' %}
                      {% endif %}">
            {% csrf_token %}

            <div class="form-group">
                <label>Descrição</label>
                <input type="text" name="descricao" 
                value="{{ cartao.descricao|default:'' }}" required>
            </div>

            <div class="form-group">
                <label>Limite</label>
                <input type="number" step="0.01" name="limite"
                value="{{ cartao.limite|default:'' }}" required>
            </div>

            <div class="form-group">
                <label>Fechamento</label>
                <input type="number" name="fechamento"
                value="{{ cartao.fechamento|default:'' }}" required>
            </div>

            <div class="form-group">
                <label>Vencimento</label>
                <input type="number" name="vencimento"
                value="{{ cartao.vencimento|default:'' }}" required>
            </div>

            <footer class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn-primary">
                    Salvar
                </button>
            </footer>
        </form>
    </div>
</div>

<script>
    function openModal() {
        document.getElementById('modalLancamento').style.display = 'flex';
    }

    function closeModal() {
        const modal = document.getElementById('modalLancamento');
        const form = document.querySelector("#modalLancamento form");
        form.reset();
        modal.style.display = 'none';
    }

    function toggleMenu() {
        document.getElementById('navLinks').classList.toggle('aberto');
    }


    function openEditModal(id, descricao, limite, fechamento, vencimento) {
    const form = document.querySelector('#modalLancamento form');

    form.action = `/cartoes/${id}/edit/`;

    form.descricao.value = descricao;
    form.limite.value = parseFloat(limite.replace(',', '.'));
    form.fechamento.value = fechamento;
    form.vencimento.value = vencimento;

    document.querySelector('#modalLancamento h2').innerText = 'Editar Cartão';

    openModal();
}

</script>

</body>
</html>
